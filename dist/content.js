!function(){const e="easyerp_credentials",t="easyerp_session_data";function n(){(function(){const e=['a[href*="logout"]',".logout","#logout",'[title*="logout"]',".user-menu",".dashboard",".user-profile",".main-content",".navigation-menu",'[href*="dashboard"]'];for(const t of e)if(document.querySelector(t))return!0;const t=["/dashboard","/home","/main","/portal"],n=window.location.pathname.toLowerCase();for(const e of t)if(n.includes(e))return!0;return!1})()&&(function(){const e=setInterval(()=>{o()},3e5);let t;const n=()=>{clearTimeout(t),t=setTimeout(()=>{o()},12e4)};["mousedown","mousemove","keypress","scroll","touchstart","click"].forEach(e=>{document.addEventListener(e,n,{passive:!0})}),o(),window.erpSessionInterval=e}(),s())}function o(){try{fetch(window.location.origin+"/api/ping",{method:"GET",credentials:"include",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>{e.ok?s():r()}).catch(()=>{r()})}catch(e){r()}}function r(){try{const e=document.createElement("iframe");e.style.display="none",e.style.width="1px",e.style.height="1px",e.src=window.location.href+"?keepalive="+Date.now(),e.onload=()=>{document.body.removeChild(e),s()},e.onerror=()=>{document.body.removeChild(e)},document.body.appendChild(e),setTimeout(()=>{e.parentNode&&document.body.removeChild(e)},1e4)}catch(e){}}function s(){const e={lastActivity:Date.now(),url:window.location.href,timestamp:(new Date).toISOString()};chrome.storage.local.set({[t]:e},()=>{chrome.runtime.lastError})}function i(){if(!window.location.href.includes("erp.iitkgp.ac.in"))return;const t=prompt("🔐 EasyERP AutoLogin\n\nEnter your Login ID:");if(!t)return;const n=prompt("🔐 EasyERP AutoLogin\n\nEnter your Password:");if(!n)return;const o={},r=prompt("🔐 EasyERP AutoLogin\n\nEnter your FIRST security question:");if(!r)return;const s=prompt(`🔐 EasyERP AutoLogin\n\nAnswer to: "${r}"`);if(!s)return;o[r]=s;const i=prompt("🔐 EasyERP AutoLogin\n\nEnter your SECOND security question:");if(!i)return;const u=prompt(`🔐 EasyERP AutoLogin\n\nAnswer to: "${i}"`);if(!u)return;o[i]=u;const a=prompt("🔐 EasyERP AutoLogin\n\nEnter your THIRD security question:");if(!a)return;const c=prompt(`🔐 EasyERP AutoLogin\n\nAnswer to: "${a}"`);if(!c)return;o[a]=c;const l={loginId:t,password:n,questions:o};chrome.storage.local.set({[e]:l},()=>{chrome.runtime.lastError?alert("❌ Error saving credentials. Please try again."):alert("✅ Credentials saved! Please reload the page to start auto-login.")})}function u(){chrome.storage.local.get([e],t=>{chrome.runtime.lastError||(t[e]&&0!==Object.keys(t[e]||{}).length?setTimeout(()=>{!function(t){const o=document.querySelector('input[name="user_id"]'),r=document.querySelector('input[name="password"]'),s=document.querySelector('input[name="email_otp"]');o&&r&&(o.focus(),o.value=t.loginId,o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout(()=>{r.focus(),r.value=t.password,r.dispatchEvent(new Event("input",{bubbles:!0})),r.dispatchEvent(new Event("change",{bubbles:!0})),r.blur();const o=new MutationObserver(()=>{const r=document.querySelector('input[name="answer"]'),i=document.querySelector("label#question");if(r&&i&&null!==r.offsetParent){const u=i.textContent.trim(),a=t.questions[u];if(!a){const n=prompt(`❓ Security Question:\n\n${u}\n\nPlease provide the answer:`);n&&(t.questions[u]=n,chrome.storage.local.set({[e]:t})),a=n}if(a){r.focus(),r.value=a,r.dispatchEvent(new Event("input",{bubbles:!0})),r.dispatchEvent(new Event("change",{bubbles:!0})),r.blur(),o.disconnect();const e=document.querySelector("#getotp");e&&e.click(),setTimeout(()=>{const e=prompt("📱 EasyERP AutoLogin\n\nStep 6: Enter the 6-digit OTP sent to your email:");if(s&&e){s.value=e,s.dispatchEvent(new Event("input",{bubbles:!0})),s.dispatchEvent(new Event("change",{bubbles:!0}));const t=document.querySelector("#loginFormSubmitButton");t&&(t.click(),setTimeout(()=>{n()},3e3))}},2e3)}}});o.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{o.disconnect()},3e4)},1200))}(t[e])},500):setTimeout(()=>{i()},1e3))})}window.EasyERPAutoLogin={setupCredentials:i,clearCredentials:()=>{chrome.storage.local.remove([e],()=>{alert("Credentials cleared! Reload page to set up new credentials.")})},viewCredentials:()=>{chrome.storage.local.get([e],t=>{t[e]})}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u()}();